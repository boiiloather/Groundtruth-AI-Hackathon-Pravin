<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H-003|AI Creative Studio</title>
    <style>
        * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                background: radial-gradient(circle at top left, #4f46e5 0%, #020617 45%, #020617 100%);
                min-height: 100vh;
                padding: 30px 16px;
                color: #e5e7eb;
            }

            /* Layout shell */
            .container {
                max-width: 1180px;
                margin: 0 auto;
            }

            /* Glass header */
            .header {
                text-align: left;
                margin-bottom: 24px;
                padding: 18px 22px;
                border-radius: 18px;
                background: rgba(15, 23, 42, 0.7);
                box-shadow: 0 18px 45px rgba(15, 23, 42, 0.7);
                border: 1px solid rgba(148, 163, 184, 0.28);
                backdrop-filter: blur(18px);
            }

            .header-top {
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 6px;
                font-size: 13px;
                text-transform: uppercase;
                letter-spacing: 0.18em;
                color: #a5b4fc;
            }

            .pill {
                padding: 4px 10px;
                border-radius: 999px;
                border: 1px solid rgba(129, 140, 248, 0.6);
                background: radial-gradient(circle at top left, rgba(129, 140, 248, 0.3), rgba(15, 23, 42, 0.4));
                font-size: 11px;
            }

            .header h1 {
                font-size: 2.15rem;
                letter-spacing: 0.03em;
                margin-bottom: 6px;
                color: #f9fafb;
            }

            .header-sub {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                gap: 10px;
                font-size: 0.95rem;
                color: #cbd5f5;
            }

            .header-sub span.accent {
                color: #a5b4fc;
                font-weight: 500;
            }

            /* Two-column main layout */
            .main-grid {
                display: grid;
                grid-template-columns: minmax(0, 1.05fr) minmax(0, 1.1fr);
                gap: 22px;
            }

            /* Glass cards */
            .glass-card {
                background: rgba(15, 23, 42, 0.78);
                border-radius: 18px;
                padding: 22px 22px 24px;
                box-shadow: 0 18px 50px rgba(15, 23, 42, 0.9);
                border: 1px solid rgba(148, 163, 184, 0.3);
                backdrop-filter: blur(18px);
            }

            /* Form section --------------------------------- */
            .section-title {
                font-size: 14px;
                text-transform: uppercase;
                letter-spacing: 0.18em;
                color: #9ca3af;
                margin-bottom: 14px;
            }

            .beta-tag {
                font-size: 11px;
                padding: 3px 9px;
                border-radius: 999px;
                background: rgba(34, 197, 94, 0.12);
                color: #bbf7d0;
                border: 1px solid rgba(34, 197, 94, 0.5);
                margin-left: 8px;
            }

            .form-row {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 13px;
                margin-bottom: 16px;
            }

            .form-group {
                margin-bottom: 14px;
            }

            .form-group label {
                display: flex;
                align-items: center;
                gap: 6px;
                margin-bottom: 6px;
                font-size: 13px;
                font-weight: 500;
                color: #e5e7eb;
            }

            .chip {
                font-size: 10px;
                text-transform: uppercase;
                padding: 2px 7px;
                border-radius: 999px;
                background: rgba(30, 64, 175, 0.55);
                color: #bfdbfe;
            }

            .form-group input,
            .form-group textarea {
                width: 100%;
                padding: 11px 11px;
                border-radius: 10px;
                border: 1px solid rgba(55, 65, 81, 0.95);
                background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.92));
                color: #e5e7eb;
                font-size: 14px;
                outline: none;
                transition: border-color 0.18s ease, box-shadow 0.18s ease, background 0.18s ease, transform 0.08s ease;
            }

            .form-group input::placeholder,
            .form-group textarea::placeholder {
                color: #6b7280;
            }

            .form-group input:focus,
            .form-group textarea:focus {
                border-color: #818cf8;
                box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.7);
                background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.45), rgba(15, 23, 42, 0.96));
                transform: translateY(-1px);
            }

            .form-group textarea {
                resize: vertical;
                min-height: 90px;
            }

            /* Error text */
            .error-message {
                color: #fca5a5;
                font-size: 12px;
                margin-top: 4px;
                display: none;
            }
            .error-message.show {
                display: block;
            }

            /* CTA button */
            .generate-btn {
                width: 100%;
                padding: 12px 16px;
                margin-top: 4px;
                border-radius: 999px;
                border: none;
                font-size: 15px;
                font-weight: 600;
                letter-spacing: 0.08em;
                text-transform: uppercase;
                color: #0b1120;
                background: radial-gradient(circle at top left, #a855f7, #f97316);
                box-shadow: 0 12px 30px rgba(248, 113, 113, 0.45);
                cursor: pointer;
                transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
            }

            .generate-btn:hover:not(:disabled) {
                transform: translateY(-1.5px) scale(1.01);
                box-shadow: 0 16px 38px rgba(248, 113, 113, 0.7);
                filter: saturate(1.1);
            }

            .generate-btn:active:not(:disabled) {
                transform: translateY(0);
                box-shadow: 0 8px 22px rgba(248, 113, 113, 0.6);
            }

            .generate-btn:disabled {
                opacity: 0.55;
                cursor: not-allowed;
            }

            /* Loading state */
            .loading {
                margin-top: 12px;
                text-align: center;
                font-size: 14px;
                color: #e5e7eb;
            }

            .spinner {
                border: 3px solid rgba(148, 163, 184, 0.3);
                border-top: 3px solid #a855f7;
                border-radius: 50%;
                width: 32px;
                height: 32px;
                animation: spin 1s linear infinite;
                margin: 0 auto 10px;
            }

            /* Results panel --------------------------------- */
            .results-container {
                display: none;
            }

            .results-container.show {
                display: block;
            }

            .results-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 18px;
            }

            .results-header h2 {
                font-size: 1.1rem;
                color: #e5e7eb;
            }
            
            .results-meta {
                font-size: 12px;
                color: #9ca3af;
                text-align: right;
            }

            /* Warning + error */
            .warning-message {
                background: rgba(250, 204, 21, 0.08);
                border: 1px solid rgba(250, 204, 21, 0.4);
                color: #facc15;
                padding: 10px 12px;
                border-radius: 10px;
                margin-bottom: 14px;
                font-size: 13px;
            }

            .error-container {
                margin-top: 16px;
                background: rgba(127, 29, 29, 0.55);
                border: 1px solid rgba(248, 113, 113, 0.75);
                color: #fee2e2;
                padding: 14px 14px 16px;
                border-radius: 12px;
                display: none;
                backdrop-filter: blur(10px);
            }
            .error-container.show {
                display: block;
            }

            .try-again-btn {
                margin-top: 8px;
                padding: 7px 13px;
                border-radius: 999px;
                border: none;
                font-size: 12px;
                text-transform: uppercase;
                letter-spacing: 0.08em;
                background: rgba(248, 113, 113, 0.95);
                color: #111827;
                cursor: pointer;
            }

            /* Creative cards */
            .creatives-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
                gap: 16px;
            }

            .creative-card {
                background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.97), rgba(15, 23, 42, 0.9));
                border-radius: 16px;
                overflow: hidden;
                box-shadow: 0 12px 32px rgba(15, 23, 42, 0.9);
                border: 1px solid rgba(51, 65, 85, 0.9);
                transition: transform 0.16s ease, box-shadow 0.16s ease, border-color 0.16s ease;
            }

            .creative-card:hover {
                transform: translateY(-4px) translateZ(0);
                box-shadow: 0 18px 40px rgba(30, 64, 175, 0.85);
                border-color: rgba(129, 140, 248, 0.85);
            }

            .creative-image {
                width: 100%;
                height: 230px;
                position: relative;
                background: radial-gradient(circle at top, #1f2937, #020617);
                display: flex;
                align-items: center;
                justify-content: center;
                color: #9ca3af;
                font-size: 13px;
            }

            .creative-image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            .creative-caption {
                padding: 13px 14px 8px;
                color: #e5e7eb;
                font-size: 14px;
                line-height: 1.5;
                min-height: 70px;
            }

            .caption-meta {
                padding: 0 14px 10px;
                font-size: 11px;
                color: #6b7280;
                display: flex;
                justify-content: space-between;
            }

            .download-btn {
                margin: 0 14px 12px;
                padding: 8px 12px;
                width: calc(100% - 28px);
                border-radius: 999px;
                border: none;
                font-size: 12px;
                text-transform: uppercase;
                letter-spacing: 0.08em;
                background: linear-gradient(135deg, #22c55e, #a3e635);
                color: #022c22;
                cursor: pointer;
                transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
            }
            .download-btn:hover:not(:disabled) {
                transform: translateY(-1px);
                box-shadow: 0 10px 22px rgba(22, 163, 74, 0.6);
                filter: saturate(1.05);
            }
            .download-btn:disabled {
                opacity: 0.45;
                cursor: not-allowed;
            }

            /* Animations */
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            /* Responsive */
            @media (max-width: 900px) {
                .main-grid {
                    grid-template-columns: minmax(0, 1fr);
                }
                body {
                    padding: 22px 12px;
                }
            }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
          <div class="header-top">
            <span class="pill">H-003 · AI Creative Studio</span>
            <span>Hackathon prototype · 3‑hour build</span>
          </div>
          <h1>Generate On‑Brand Ad Creatives</h1>
          <div class="header-sub">
            <span>From brief to <span class="accent">production‑ready visuals</span> in seconds.</span>
          </div>
        </div>

        <div class="main-grid">
            <div class="glass-card">
                <div class="form-container">
                <form id="adForm">
                    <div class="form-group">
                        <label for="brandName">Brand Name *</label>
                        <input type="text" id="brandName" name="brandName" required placeholder="e.g., EcoSip">
                        <div class="error-message" id="brandNameError">Brand name is required</div>
                    </div>

                    <div class="form-group">
                        <label for="productDescription">Product Description *</label>
                        <textarea id="productDescription" name="productDescription" required placeholder="e.g., Reusable stainless-steel water bottle"></textarea>
                        <div class="error-message" id="productDescriptionError">Product description is required</div>
                    </div>

                    <div class="form-group">
                        <label for="targetAudience">Target Audience *</label>
                        <input type="text" id="targetAudience" name="targetAudience" required placeholder="e.g., College students">
                        <div class="error-message" id="targetAudienceError">Target audience is required</div>
                    </div>

                    <div class="form-group">
                        <label for="tone">Tone/Style *</label>
                        <input type="text" id="tone" name="tone" required placeholder="e.g., Casual, eco-friendly">
                        <div class="error-message" id="toneError">Tone/style is required</div>
                    </div>

                <button type="submit" class="generate-btn" id="generateBtn">Generate Ads</button>
            </form>
            </div>
        

            <div class="glass-card">

                </div><div class="loading" id="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Generating your ad creatives... This may take 10-20 seconds.</p>
                </div>

                <div class="error-container" id="errorContainer">
                    <h3>⚠️ Error</h3>
                    <p id="errorMessage"></p>
                    <button class="try-again-btn" onclick="resetForm()">Try Again</button>
                </div>

                <div class="results-container" id="resultsContainer">
                    <div class="results-header">
                        <h2>Generated Creatives</h2>
                        <div class="results-meta" id="resultsMeta"></div>
                    </div>
                    <div id="warningMessage" class="warning-message" style="display: none;"></div>
                    <div class="creatives-grid" id="creativesGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auto-detect API URL based on current page
        const API_URL = window.location.origin === 'file://' || window.location.port === '' 
            ? 'http://localhost:8000' 
            : window.location.origin;

        document.getElementById('adForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Reset UI
            hideError();
            hideResults();
            hideLoading();
            
            // Validate form
            if (!validateForm()) {
                return;
            }
            
            // Get form data
            const formData = {
                brand_name: document.getElementById('brandName').value.trim(),
                product_description: document.getElementById('productDescription').value.trim(),
                target_audience: document.getElementById('targetAudience').value.trim(),
                tone: document.getElementById('tone').value.trim()
            };
            
            // Show loading
            showLoading();
            document.getElementById('generateBtn').disabled = true;
            
            try {
                const response = await fetch(`${API_URL}/generate-ads`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.detail || 'Failed to generate ads');
                }
                
                if (data.success && data.creatives && data.creatives.length > 0) {
                    displayResults(data.creatives, data.message, data.image_provider);
                } else {
                    throw new Error(data.message || 'No creatives were generated');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showError(error.message || 'An error occurred while generating ads. Please try again.');
            } finally {
                hideLoading();
                document.getElementById('generateBtn').disabled = false;
            }
        });
        
        function validateForm() {
            let isValid = true;
            const fields = ['brandName', 'productDescription', 'targetAudience', 'tone'];
            
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                const errorDiv = document.getElementById(fieldId + 'Error');
                
                if (!field.value.trim()) {
                    errorDiv.classList.add('show');
                    isValid = false;
                } else {
                    errorDiv.classList.remove('show');
                }
            });
            
            return isValid;
        }
        
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorContainer').classList.add('show');
        }
        
        function hideError() {
            document.getElementById('errorContainer').classList.remove('show');
        }
        
        function showResults() {
            document.getElementById('resultsContainer').classList.add('show');
        }
        
        function hideResults() {
            document.getElementById('resultsContainer').classList.remove('show');
        }
        
        function displayResults(creatives, warningMessage, imageProvider) {
            const grid = document.getElementById('creativesGrid');
            grid.innerHTML = '';
            
            if (warningMessage) {
                document.getElementById('warningMessage').textContent = warningMessage;
                document.getElementById('warningMessage').style.display = 'block';
            } else {
                document.getElementById('warningMessage').style.display = 'none';
            }

            // Show which image provider was used (for judges / debugging)
            const metaEl = document.getElementById('resultsMeta');
            if (metaEl) {
                if (imageProvider) {
                    metaEl.textContent = `Images via ${imageProvider}`;
                } else {
                    metaEl.textContent = '';
                }
            }
            
            creatives.forEach((creative, index) => {
                const card = document.createElement('div');
                card.className = 'creative-card';
                
                const imageDiv = document.createElement('div');
                imageDiv.className = 'creative-image';
                
                if (creative.image_url) {
                    const img = document.createElement('img');
                    img.src = creative.image_url;
                    img.alt = `Ad creative ${index + 1}`;
                    img.onerror = function() {
                        this.parentElement.textContent = 'Image failed to load';
                    };
                    imageDiv.appendChild(img);
                } else {
                    imageDiv.textContent = 'No image available';
                }
                
                const captionDiv = document.createElement('div');
                captionDiv.className = 'creative-caption';
                captionDiv.textContent = creative.caption || 'No caption available';
                
                const downloadBtn = document.createElement('button');
                downloadBtn.className = 'download-btn';
                downloadBtn.textContent = 'Download Image';
                downloadBtn.onclick = () => downloadImage(creative.image_url, `ad-creative-${index + 1}.png`);
                if (!creative.image_url) {
                    downloadBtn.disabled = true;
                    downloadBtn.style.opacity = '0.5';
                    downloadBtn.style.cursor = 'not-allowed';
                }
                
                card.appendChild(imageDiv);
                card.appendChild(captionDiv);
                card.appendChild(downloadBtn);
                
                grid.appendChild(card);
            });
            
            showResults();
        }
        
        function downloadImage(url, filename) {
            if (!url) return;
            
            // Handle base64 data URLs (from Hugging Face)
            if (url.startsWith('data:image')) {
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                return;
            }
            
            // Handle regular URLs (from OpenAI)
            fetch(url)
                .then(response => response.blob())
                .then(blob => {
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                })
                .catch(error => {
                    console.error('Download error:', error);
                    alert('Failed to download image. Please try right-clicking and saving the image.');
                });
        }
        
        function resetForm() {
            hideError();
            hideResults();
            document.getElementById('adForm').reset();
        }
    </script>
</body>
</html>

